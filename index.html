<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AutoPilot IDE - AI-Enabled Integrated Development Environment">
    <meta name="theme-color" content="#1e1e1e">
    <title>AutoPilot IDE - AI-Enabled IDE</title>
    
    <!-- External Dependencies -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    
    <!-- Monaco Editor -->
    <link rel="stylesheet" data-name="vs/editor/editor.main" href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/editor/editor.main.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js"></script>
    <script>
        require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs' }});
    </script>
    
    <!-- Xterm.js Terminal -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css" />
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.js"></script>
    
    <!-- Application Modules (Load Order is Critical) -->
    <script src="js/utils.js"></script> <!-- Utility functions (no dependencies) -->
    <script src="js/api-module.js"></script> <!-- API communication layer -->
    <script src="js/socket-module.js"></script> <!-- WebSocket communication -->
    <script src="js/ui-module.js"></script> <!-- UI foundation -->
    <script src="js/editor-module.js"></script> <!-- Editor management -->
    <script src="js/terminal-module.js"></script> <!-- Terminal integration -->
    <script src="js/explorer-module.js"></script> <!-- File explorer -->
    <script src="js/ai-module.js"></script> <!-- AI assistant -->
    <script src="js/extension-module.js"></script> <!-- Extension system -->
    <script src="js/event-handlers.js"></script> <!-- Event handling -->
    <script src="js/app.js"></script> <!-- Main application coordinator -->
    <script src="js/project-manager.js"></script> <!-- Project management -->
    
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <h1>AutoPilot IDE</h1>
            </div>
            <nav class="nav">
                <button id="new-project-btn" class="btn">New Project</button>
                <button id="open-project-btn" class="btn">Open Project</button>
                <button id="save-btn" class="btn">Save</button>
                <button id="run-btn" class="btn btn-primary">Run</button>
            </nav>
        </header>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Sidebar / File Explorer -->
            <aside class="sidebar">
                <div class="explorer-header">
                    <h3>Explorer</h3>
                    <button id="refresh-explorer-btn" class="icon-btn">↻</button>
                </div>
                <div id="file-tree" class="file-tree">
                    <!-- File tree will be populated here -->
                </div>
            </aside>

            <!-- Editor Area -->
            <main class="editor-area">
                <div class="tabs" id="editor-tabs">
                    <!-- Editor tabs will be added here -->
                </div>
                <div id="editor-container" class="editor-container">
                    <!-- Monaco Editor will be initialized here -->
                </div>
            </main>

            <!-- Right Panel (AI Assistant, Terminal, etc.) -->
            <aside class="right-panel">
                <div class="panel-tabs">
                    <button class="panel-tab active" data-panel="ai">AI Assistant</button>
                    <button class="panel-tab" data-panel="terminal">Terminal</button>
                    <button class="panel-tab" data-panel="output">Output</button>
                </div>
                
                <!-- AI Assistant Panel -->
                <div id="ai-panel" class="panel-content active">
                    <div class="ai-chat" id="ai-chat">
                        <!-- AI chat messages will appear here -->
                    </div>
                    <div class="ai-input-area">
                        <textarea id="ai-input" placeholder="Ask AI for help..."></textarea>
                        <button id="ai-send-btn" class="btn btn-primary">Send</button>
                    </div>
                </div>

                <!-- Terminal Panel -->
                <div id="terminal-panel" class="panel-content">
                    <div id="terminal-container" class="terminal-container">
                        <!-- Xterm.js terminal will be initialized here -->
                    </div>
                </div>

                <!-- Output Panel -->
                <div id="output-panel" class="panel-content">
                    <div id="output-container" class="output-container">
                        <!-- Program output will appear here -->
                    </div>
                </div>
            </aside>
        </div>

        <!-- Status Bar -->
        <footer class="status-bar">
            <div class="status-left">
                <span id="status-message">Ready</span>
            </div>
            <div class="status-right">
                <span id="cursor-position">Ln 1, Col 1</span>
                <span id="file-encoding">UTF-8</span>
                <span id="file-type">Plain Text</span>
            </div>
        </footer>
    </div>

    <!-- Initialization Script -->
    <script>
        // Application Initialization
        console.log('[Init] Starting AutoPilot IDE...');
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('[Init] DOM Content Loaded');
            
            // Check if all modules are loaded
            const requiredModules = [
                'utils', 'apiModule', 'socketModule', 'uiModule',
                'editorModule', 'terminalModule', 'explorerModule',
                'aiModule', 'extensionModule', 'eventHandlers', 'app'
            ];
            
            const loadedModules = [];
            const missingModules = [];
            
            requiredModules.forEach(module => {
                if (typeof window[module] !== 'undefined') {
                    loadedModules.push(module);
                    console.log('[Init] ✓ Module loaded:', module);
                } else {
                    missingModules.push(module);
                    console.warn('[Init] ✗ Module missing:', module);
                }
            });
            
            console.log('[Init] Loaded modules:', loadedModules.length + '/' + requiredModules.length);
            
            if (missingModules.length > 0) {
                console.warn('[Init] Missing modules:', missingModules.join(', '));
            }
            
            // Initialize the application
            try {
                if (typeof app !== 'undefined' && typeof app.init === 'function') {
                    console.log('[Init] Initializing main application...');
                    app.init();
                } else if (typeof window.app !== 'undefined' && typeof window.app.init === 'function') {
                    console.log('[Init] Initializing main application (window.app)...');
                    window.app.init();
                } else {
                    console.warn('[Init] Main app.init() not found, modules may need manual initialization');
                }
                
                // Initialize project system
                if (typeof initializeProjectSystem === 'function') {
                    console.log('[Init] Initializing project system...');
                    initializeProjectSystem();
                } else if (typeof projectManager !== 'undefined') {
                    console.log('[Init] ProjectManager loaded');
                }
                
                console.log('[Init] ✓ AutoPilot IDE initialized successfully');
            } catch (error) {
                console.error('[Init] ✗ Error during initialization:', error);
            }
        });
        
        // Global error handlers
        window.addEventListener('error', function(event) {
            console.error('[Global Error]', event.error);
        });
        
        window.addEventListener('unhandledrejection', function(event) {
            console.error('[Unhandled Promise Rejection]', event.reason);
        });
    </script>
</body>
</html>